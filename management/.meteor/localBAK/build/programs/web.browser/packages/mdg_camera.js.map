)]}'
{"version":3,"sources":["mdg:camera/photo.html","mdg:camera/photo.js","mdg:camera/photo-browser.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,+B;AACA,kE;AACA,kB;AACA,qF;AACA,yB;AACA,qD;AACA,oE;AACA,qB;AACA,mC;AACA,W;AACA,K;AACA,oC;AACA,gD;AACA,iB;AACA,8C;AACA,kE;AACA,mB;AACA,sG;AACA,mB;AACA,kD;AACA,uE;AACA,qB;AACA,iE;AACA,kB;AACA,+G;AACA,Y;AACA,uB;AACA,wE;AACA,2B;AACA,qB;AACA,iE;AACA,kB;AACA,+E;AACA,Y;AACA,uB;AACA,wE;AACA,2B;AACA,uB;AACA,mB;AACA,iB;AACA,8C;AACA,kD;AACA,mB;AACA,uC;AACA,yB;AACA,mC;AACA,yB;AACA,0D;AACA,U;AACA,gC;AACA,kE;AACA,mC;AACA,sD;AACA,mC;AACA,yE;AACA,mB;AACA,gG;AACA,mB;AACA,gB;AACA,I;;AAEA,mC;AACA,0E;AACA,kB;AACA,qB;AACA,yB;AACA,2B;AACA,gB;AACA,yB;AACA,kC;AACA,mE;AACA,qB;AACA,wB;AACA,S;AACA,K;AACA,4E;AACA,+D;AACA,iB;AACA,qF;AACA,iB;AACA,wC;AACA,+B;AACA,mC;AACA,8K;AACA,I;;AAEA,qC;AACA,8E;AACA,kB;AACA,mB;AACA,4B;AACA,6C;AACA,sD;AACA,iF;AACA,I;;AAEA,yC;AACA,sF;AACA,kB;AACA,m5B;AACA,I;;;;;;;;;;;;;;;;;;;ACrGA,kB;;;;;;;;;;;;;;;;;;ACAA,W;AACA,qB;;AAEA,kC;AACA,kC;AACA,iD;;AAEA,oB;AACA,qB;;AAEA,iB;;AAEA,2C;AACA,sB;;AAEA,iC;;AAEA,qC;;AAEA,+C;AACA,qC;AACA,uB;;AAEA,oC;AACA,kC;AACA,Y;AACA,qD;AACA,oD;AACA,K;AACA,iB;;AAEA,oC;AACA,I;;AAEA,gD;AACA,+B;AACA,mB;AACA,I;;AAEA,uC;AACA,4B;AACA,6B;AACA,mC;AACA,gC;AACA,4B;AACA,I;;AAEA,iC;AACA,gC;AACA,qC;AACA,W;AACA,G;;AAEA,gC;AACA,0B;AACA,kB;AACA,kB;AACA,uB;;AAEA,uE;AACA,4B;AACA,6B;AACA,sB;AACA,gD;AACA,oB;AACA,kF;AACA,mD;AACA,qD;AACA,qB;AACA,K;AACA,Y;AACA,E;;AAEA,kD;AACA,yC;AACA,yB;AACA,uE;AACA,kD;AACA,I;AACA,E;;AAEA,sD;AACA,4C;AACA,gE;AACA,E;;AAEA,yB;AACA,sB;AACA,uB;AACA,I;AACA,sB;AACA,uB;AACA,I;AACA,+C;AACA,oD;AACA,G;;AAEA,wB;AACA,mC;AACA,wC;AACA,I;AACA,mC;AACA,oB;AACA,I;AACA,gC;AACA,kC;AACA,gG;AACA,4C;AACA,iG;AACA,6B;AACA,2G;AACA,Y;AACA,kF;AACA,K;AACA,I;AACA,iB;AACA,oB;AACA,K;AACA,G;AACA,G;;AAEA,4B;AACA,gD;AACA,uC;AACA,yC;;AAEA,+B;AACA,iC;AACA,8E;AACA,uD;AACA,oB;AACA,kB;AACA,G;AACA,G;;AAEA,6B;AACA,uC;AACA,sC;AACA,G;AACA,G;;AAEA,G;AACA,2D;AACA,sC;AACA,iE;AACA,+D;AACA,gD;AACA,4E;AACA,gF;AACA,wB;AACA,6E;AACA,kD;AACA,G;AACA,wD;AACA,8B;AACA,mB;AACA,uB;AACA,iB;AACA,G;;AAEA,wC;AACA,sC;;AAEA,wE;AACA,0C;;AAEA,6C;AACA,wC;AACA,iC;AACA,U;AACA,wC;AACA,+B;AACA,G;;AAEA,wC;AACA,0C;;AAEA,W;AACA,E;AACA,kC;AACA,iC;AACA,oB;AACA,oB;AACA,uC;AACA,I;AACA,E;AACA,4C;AACA,iC;AACA,E","file":"/packages/mdg:camera.js","sourcesContent":["\nTemplate.__checkName(\"camera\");\nTemplate[\"camera\"] = new Template(\"Template.camera\", (function() {\n  var view = this;\n  return [ HTML.Raw('<div class=\"camera-overlay\">\\n    \\n  </div>\\n\\n  '), HTML.DIV({\n    \"class\": function() {\n      return [ \"camera-popup \", Blaze.If(function() {\n        return Spacebars.call(view.lookup(\"permissionDeniedError\"));\n      }, function() {\n        return \"camera-popup-wide\";\n      }) ];\n    }\n  }, \"\\n    \", Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"error\"));\n  }, function() {\n    return [ \"\\n      \", Blaze.If(function() {\n      return Spacebars.call(view.lookup(\"permissionDeniedError\"));\n    }, function() {\n      return [ \"\\n        \", Spacebars.include(view.lookupTemplate(\"permissionDenied\")), \"\\n      \" ];\n    }, function() {\n      return [ \"\\n        \", Blaze.If(function() {\n        return Spacebars.call(view.lookup(\"browserNotSupportedError\"));\n      }, function() {\n        return [ \"\\n          \", Blaze._TemplateWith(function() {\n          return {\n            message: Spacebars.call(\"Sorry, this browser is currently not supported for camera functionality.\")\n          };\n        }, function() {\n          return Spacebars.include(view.lookupTemplate(\"genericError\"));\n        }), \"\\n        \" ];\n      }, function() {\n        return [ \"\\n          \", Blaze._TemplateWith(function() {\n          return {\n            message: Spacebars.call(\"There was an error accessing the camera.\")\n          };\n        }, function() {\n          return Spacebars.include(view.lookupTemplate(\"genericError\"));\n        }), \"\\n        \" ];\n      }), \"\\n      \" ];\n    }), \"\\n    \" ];\n  }, function() {\n    return [ \"\\n      \", Blaze.If(function() {\n      return Spacebars.call(view.lookup(\"photo\"));\n    }, function() {\n      return [ \"\\n        \", HTML.DIV({\n        \"class\": \"center\"\n      }, \"\\n          \", HTML.IMG({\n        src: function() {\n          return Spacebars.mustache(view.lookup(\"photo\"));\n        },\n        \"class\": \"photo-preview\"\n      }), \"\\n          \", HTML.DIV(\"\\n            \", HTML.BUTTON({\n        \"class\": \"button use-photo\"\n      }, \"Use Photo\"), \"\\n            \", HTML.BUTTON({\n        \"class\": \"button new-photo\"\n      }, \"Take New Photo\"), \"\\n          \"), \"\\n        \"), \"\\n      \" ];\n    }, function() {\n      return [ \"\\n        \", Spacebars.include(view.lookupTemplate(\"viewfinder\")), \"\\n      \" ];\n    }), \"\\n    \" ];\n  }), \"\\n  \") ];\n}));\n\nTemplate.__checkName(\"viewfinder\");\nTemplate[\"viewfinder\"] = new Template(\"Template.viewfinder\", (function() {\n  var view = this;\n  return [ HTML.DIV({\n    \"class\": \"viewfinder\"\n  }, \"\\n    \", HTML.VIDEO({\n    id: \"video\",\n    \"class\": function() {\n      return Blaze.If(function() {\n        return Spacebars.call(view.lookup(\"waitingForPermission\"));\n      }, function() {\n        return \"hidden\";\n      });\n    }\n  }, \"\\n      \"), \"\\n    \\n    \", HTML.DIV(\"\\n      \", Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"waitingForPermission\"));\n  }, function() {\n    return [ \"\\n        \", HTML.P(\"Waiting for camera permissions...\"), \"\\n      \" ];\n  }, function() {\n    return [ \"\\n        \", HTML.BUTTON({\n      \"class\": \"button shutter\"\n    }, \"Take Photo\"), \"\\n      \" ];\n  }), \"\\n      \", HTML.Raw('<button class=\"button cancel\">Cancel</button>'), \"\\n    \"), \"\\n  \"), HTML.Raw('\\n\\n  <canvas id=\"canvas\" style=\"visibility: hidden\"></canvas>') ];\n}));\n\nTemplate.__checkName(\"genericError\");\nTemplate[\"genericError\"] = new Template(\"Template.genericError\", (function() {\n  var view = this;\n  return HTML.DIV({\n    \"class\": \"generic-error\"\n  }, \"\\n    \", HTML.P(Blaze.View(function() {\n    return Spacebars.mustache(view.lookup(\"message\"));\n  })), HTML.Raw('\\n    <button class=\"button cancel\">Close Popup</button>\\n  '));\n}));\n\nTemplate.__checkName(\"permissionDenied\");\nTemplate[\"permissionDenied\"] = new Template(\"Template.permissionDenied\", (function() {\n  var view = this;\n  return HTML.Raw('<div class=\"permission-denied-error\">\\n    <h2>Camera Permissions Denied</h2>\\n\\n    <p>\\n      You have denied this app permission to use your camera.\\n      If you would like to allow permissions, follow the directions for your\\n      browser below.\\n    </p>\\n\\n    <dl class=\"permissions-howto\">\\n      <dt>Google Chrome</dt>\\n        <dd>Go to Settings > \"Show advanced settings...\" >\\n          \"Content settings...\" > Media heading > \"Manage exceptions...\",\\n          then find this website in the list and allow video capture.</dd>\\n      <dt>Mozilla Firefox</dt>\\n        <dd>Reload the page and try again.</dd>\\n      <dt>Opera</dt>\\n        <dd>Go to Preferences > Websites > Media heading >\\n          \"Manage exceptions...\", then find this website in the list and\\n          allow video capture.</dd>\\n    </dl>\\n\\n    <button class=\"button cancel\">Close Popup</button>\\n  </div>');\n}));\n","MeteorCamera = {};","var stream;\nvar closeAndCallback;\n\nvar photo = new ReactiveVar(null);\nvar error = new ReactiveVar(null);\nvar waitingForPermission = new ReactiveVar(null);\n\nvar canvasWidth = 0;\nvar canvasHeight = 0;\n\nvar quality = 80;\n\nTemplate.viewfinder.rendered = function() {\n  var template = this;\n\n  waitingForPermission.set(true);\n\n  var video = template.find(\"video\");\n\n  // stream webcam video to the <video> element\n  var success = function(newStream) {\n    stream = newStream;\n\n    if (navigator.mozGetUserMedia) {\n      video.mozSrcObject = stream;\n    } else {\n      var vendorURL = window.URL || window.webkitURL;\n      video.src = vendorURL.createObjectURL(stream);\n    }\n    video.play();\n\n    waitingForPermission.set(false);\n  };\n\n  // user declined or there was some other error\n  var failure = function(err) {\n    error.set(err);\n  };\n\n  // tons of different browser prefixes\n  navigator.getUserMedia = (\n    navigator.getUserMedia ||\n    navigator.webkitGetUserMedia ||\n    navigator.mozGetUserMedia ||\n    navigator.msGetUserMedia\n  );\n\n  if (! navigator.getUserMedia) {\n    // no browser support, sorry\n    failure(\"BROWSER_NOT_SUPPORTED\");\n    return;\n  }\n\n  // initiate request for webcam\n  navigator.getUserMedia({\n      video: true,\n      audio: false\n  }, success, failure);\n\n  // resize viewfinder to a reasonable size, not necessarily photo size\n  var viewfinderWidth = 320;\n  var viewfinderHeight = 240;\n  var resized = false;\n  video.addEventListener('canplay', function() {\n    if (! resized) {\n      viewfinderHeight = video.videoHeight / (video.videoWidth / viewfinderWidth);\n      video.setAttribute('width', viewfinderWidth);\n      video.setAttribute('height', viewfinderHeight);\n      resized = true;\n    }\n  }, false);\n};\n\n// is the current error a permission denied error?\nvar permissionDeniedError = function () {\n  return error.get() && (\n    error.get().name === \"PermissionDeniedError\" || // Chrome and Opera\n    error.get() === \"PERMISSION_DENIED\" // Firefox\n  );\n};\n\n// is the current error a browser not supported error?\nvar browserNotSupportedError = function () {\n  return error.get() && error.get() === \"BROWSER_NOT_SUPPORTED\";\n};\n\nTemplate.camera.helpers({\n  photo: function () {\n    return photo.get();\n  },\n  error: function () {\n    return error.get();\n  },\n  permissionDeniedError: permissionDeniedError,\n  browserNotSupportedError: browserNotSupportedError\n});\n\nTemplate.camera.events({\n  \"click .use-photo\": function () {\n    closeAndCallback(null, photo.get());\n  },\n  \"click .new-photo\": function () {\n    photo.set(null);\n  },\n  \"click .cancel\": function () {\n    if (permissionDeniedError()) {\n      closeAndCallback(new Meteor.Error(\"permissionDenied\", \"Camera permissions were denied.\"));\n    } else if (browserNotSupportedError()) {\n      closeAndCallback(new Meteor.Error(\"browserNotSupported\", \"This browser isn't supported.\"));\n    } else if (error.get()) {\n      closeAndCallback(new Meteor.Error(\"unknownError\", \"There was an error while accessing the camera.\"));\n    } else {\n      closeAndCallback(new Meteor.Error(\"cancel\", \"Photo taking was cancelled.\"));\n    }\n    \n    if (stream) {\n      stream.stop();\n    }\n  }\n});\n\nTemplate.viewfinder.events({\n  'click .shutter': function (event, template) {\n    var video = template.find(\"video\");\n    var canvas = template.find(\"canvas\");\n\n    canvas.width = canvasWidth;\n    canvas.height = canvasHeight;\n    canvas.getContext('2d').drawImage(video, 0, 0, canvasWidth, canvasHeight);\n    var data = canvas.toDataURL('image/jpeg', quality);\n    photo.set(data);\n    stream.stop();\n  }\n});\n\nTemplate.viewfinder.helpers({\n  \"waitingForPermission\": function () {\n    return waitingForPermission.get();\n  }\n});\n\n/**\n * @summary Get a picture from the device's default camera.\n * @param  {Object}   options  Options\n * @param {Number} options.height The minimum height of the image\n * @param {Number} options.width The minimum width of the image\n * @param {Number} options.quality [description]\n * @param  {Function} callback A callback that is called with two arguments:\n * 1. error, an object that contains error.message and possibly other properties\n * depending on platform\n * 2. data, a Data URI string with the image encoded in JPEG format, ready to\n * use as the `src` attribute on an `<img />` tag.\n */\nMeteorCamera.getPicture = function (options, callback) {\n  // if options are not passed\n  if (! callback) {\n    callback = options;\n    options = {};\n  }\n\n  desiredHeight = options.height || 640;\n  desiredWidth = options.width || 480;\n\n  // Canvas#toDataURL takes the quality as a 0-1 value, not a percentage\n  quality = (options.quality || 49) / 100;\n\n  if (desiredHeight * 4 / 3 > desiredWidth) {\n    canvasWidth = desiredHeight * 4 / 3;\n    canvasHeight = desiredHeight;\n  } else {\n    canvasHeight = desiredWidth * 3 / 4;\n    canvasWidth = desiredWidth;\n  }\n\n  canvasWidth = Math.round(canvasWidth);\n  canvasHeight = Math.round(canvasHeight);\n\n  var view;\n  \n  closeAndCallback = function () {\n    var originalArgs = arguments;\n    UI.remove(view);\n    photo.set(null);\n    callback.apply(null, originalArgs);\n  };\n  \n  view = UI.renderWithData(Template.camera);\n  UI.insert(view, document.body);\n};\n"]}