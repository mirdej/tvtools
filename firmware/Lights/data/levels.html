<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">
	<title> TV.Lights - Levels </title>
	<link rel="stylesheet" href="src/bootstrap.min.css">
	<link rel="stylesheet" href="src/jquery-ui.min.css">
	<script src="src/jquery-3.4.1.min.js">
	</script>
	<script src="src/jquery-ui.min.js">
	</script>
	<style>		
			
			.nr {width:30px;}
			.on .off {padding:2px;height:14px;}
			.level {
				  float: left;
				  clear: left;
				  width: 110px;
				  margin: 10px;
				  background: #444;
				}
			.ui-slider-range { background: #fff; }
	</style>
</head>
<body>
<div class="container-fluid">
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<a class="navbar-brand" href="#"> TV Lights v2.0 by [&nbsp;a&nbsp;n&nbsp;y&nbsp;m&nbsp;a&nbsp;] </a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"> </span> </button> 
		<div class="collapse navbar-collapse" id="navbarSupportedContent">
			<ul class="navbar-nav mr-auto">
				<li class="nav-item active"> <a class="nav-link" href="/"> Home <span class="sr-only"> (current) </span> </a> </li>
				<li class="nav-item active"> <a class="nav-link" href="levels"> Presets </a> </li>
				<li class="nav-item active"> <a class="nav-link" href="colors"> Colors</a> </li>
				<li class="nav-item active"> <a class="nav-link" href="fixtures"> Fixture check</a> </li>
				<li class="nav-item active"> <a class="nav-link" href="http://switchbox.local/"> Switcher</a> </li>
			</ul>
		</div>
	</nav>
	<div class="card" id="fixtures">
		<div class="card-header" id="Cues">
		</div>
		<div class="alert alert-warning" id="savingalert" role="alert">
			Saving.... 
		</div>
		<div class="card-body" id="individualcontrol">
		</div>
	</div>
	<div class="card">
		<div class="card-header" id="Commands">
			<button id="savebutton" type="button" class="btn btn-lg btn-outline-light">Save</button> <button id="deletebutton" type="button" class="btn btn-lg btn-outline-light">Delete</button> <button id="newbutton" type="button" class="btn btn-lg btn-outline-light">New</button> 
		</div>
	</div>
</div>
<div id="template" class="invisible">
	<div class="row new">
		<span class="nr"></span>
		<div class="off btn btn-sm btn-outline-light">
			0
		</div>
		<div class="level">
		</div>
		<div class="on btn btn-sm btn-outline-light">
			100
		</div>
	</div>
</div>
<div id="dialog-confirm" title="Delete Cue?" class="invisible">
	<p>
		<span class="ui-icon ui-icon-alert" style="float:left; margin:12px 12px 20px 0;"></span>These items will be permanently deleted and cannot be recovered. Are you sure? 
	</p>
</div>
<div id="dialog-form" title="Create new Cue">
	<form>
		<fieldset>
			<label for="name">Name</label> 
			<input type="text" name="name" id="name" value="New" class="text ui-widget-content ui-corner-all">
<!-- Allow form submission with keyboard without duplicating the dialog button -->
			<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
		</fieldset>
	</form>
</div>
<script>
	
	$( document ).ready(function(){
	
	    $('#savingalert').hide();
	
	    function build_cuelist(data) {
	            var items = data.split(',');
	            	            console.log(items);

	            var buttons = ""
	            for (var i = 0; i < items.length; i++) {
	                    buttons += '<button type="button" class="cue btn btn-lg btn-outline-light">';
	                    buttons += items[i];//.split('/')[2];
	                    buttons += '</button> ';
	
	            }
	                $( "#Cues" ).html( buttons );
	                $('.cue').click(function(e){
	                   // var val = $(this).prevAll().length;
	                    
	                    $( "button" ).removeClass('btn-light');
	                    $( "button" ).addClass('btn-outline-light');
	                    $(this).removeClass('btn-outline-light');
	                    $(this).addClass('btn-light');
	                    var val = $(this).html()
	                    $.get('http://lights.local/recall?file='+val, function( data ) {
	                        
	                           var level = data.split(",");
	   
	                    	    $('#individualcontrol').html("");
	     
	                            for (var i = 0; i < level.length; i++) {
	                                    $('#individualcontrol').append( $('#template').html())
	                                    $('#individualcontrol .new .nr').attr("id","h_"+i)
	                                    $('#individualcontrol .new .nr').html(i + 1)
	                                    $('#individualcontrol .new .level').attr("fixture",i)
	                                    $('#individualcontrol .new .level').slider({
	                                            orientation: "horizontal",
	                                            range: "min",
	                                            max: 255,
	                                            value: parseInt(parseFloat(level[i])*255.),
	                                            slide: refreshLevel,
	                                            change: refreshLevel
	                                     });	  
	                                $('#individualcontrol .new').removeClass("new")
	                        }
	                        
	                        $('.on').click(function(e){
	                                     $(this).siblings('.level').slider( "value",255 )
	                        })
	                        $('.off').click(function(e){
	                                     $(this).siblings('.level').slider( "value",0 )
	                        })
	                    });
	                })
	                $( "#Cues button" ).first().click();
	
	            } 
	
	
	 	   
	   
	 
	  function refreshLevel() {
	    level = $(this).slider( "value" );
	    var idx =$(this).attr("fixture");
	    $.get('http://lights.local/set?channel='+idx+'&value='+level);
	     };
	 
	 
	 $('#savebutton').click(function(e){
	        $('#savingalert').show();
	            var name = ($("#Cues .btn-light").html());        
	    	    $.get('http://lights.local/save?file='+name,function(data){
	              $('#savingalert').html(data);
	              $('#savingalert').fadeOut(1000);
	    })
	 });
	 
	  
	  dialog = $( "#dialog-form" ).dialog({
	          autoOpen: false,
	          height: 400,
	          width: 350,
	          modal: true,
	          buttons: {
	            "Create": addCue,
	            Cancel: function() {
	              dialog.dialog( "close" );
	            }
	          },
	          close: function() {
	            form[ 0 ].reset();
	          }
	        });
	 
	        form = dialog.find( "form" ).on( "submit", function( event ) {
	          event.preventDefault();
	          addCue();
	    });
	 
	    $( "#newbutton" ).click( function() {
	      dialog.dialog( "open" );
	    });
	    
	 
	 function addCue() {
	        $( "button" ).removeClass('btn-light');
	        $( "button" ).addClass('btn-outline-light');
	         var buttons = ""
	        buttons += '<button type="button" class="cue btn btn-lg btn-light">';
	        buttons += $('#name').val();
	        buttons += '</button> ';
	        $("#Cues").append(buttons);
	        dialog.dialog( "close" );
	    }
	    
	   
	    
	    
	    
	
	 $('#deletebutton').click(function(e){
	         $( "#dialog-confirm" ).dialog({
	          resizable: false,
	          height: "auto",
	          width: 400,
	          modal: true,
	          buttons: {
	            "Delete cue": function() {
	            	var name = ($("#Cues .btn-light").html());
	        	    $.get('http://lights.local/delete?file='+name,function(data) {build_cuelist(data)});
	              $( this ).dialog( "close" );
	            },
	            Cancel: function() {
	              $( this ).dialog( "close" );
	            }
	          }
	        });
	 });
	 
	        $.get('http://lights.local/getcameo',function(data) {build_cuelist(data)});
	
	});
</script>
</body>
</html>
